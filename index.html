<!DOCTYPE html>
<!--
 * HTML-Sheets-of-Paper (https://github.com/delight-im/HTML-Sheets-of-Paper)
 * Copyright (c) delight.im (https://www.delight.im/)
 * Licensed under the MIT License (https://opensource.org/licenses/MIT)
-->
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="description" content="Emulating real sheets of paper in web documents (using HTML and CSS)">
		<title>Sheets of Paper</title>
		<link rel="stylesheet" type="text/css" href="css/sheets-of-paper-a4-landscape.css">
    <style>
      .page {
      }
      .row {
        margin: 0.5cm 0;
        display: flex;
        flex-direction: row;
        align-items: stretch;
        justify-content: space-between;
      }
      .cell {
        display: inline-block;
        width: 50%;
        height: 8.75cm;
        border: 1px solid black;
        padding: 0.2cm;
        margin: 0cm 0.2cm;
        overflow: hidden;
      }
    </style>
	</head>
	<body>
    <template id='pageTemplate'>
      <div class="page">
        <div class="row">
          <div class="cell" contenteditable="true">
          </div>
          <div class="cell" contenteditable="true">
          </div>
        </div>
        <div class="row">
          <div class="cell" contenteditable="true">
          </div>
          <div class="cell" contenteditable="true">
          </div>
        </div>
      </div>
    </template>
    <div class="action">
      <button id='btnPreview' onclick="preview()">preview</button>
      <button id='btnBack' onclick="restore()">back</button>
      <button id='btnAddPage' onclick="addPage()">add page</button>
    </div>
    <div id="document">
    </div>
		<script type="text/javascript">
      const btnPreview = document.getElementById('btnPreview');
      const btnBack = document.getElementById('btnBack');
      const btnAddPage = document.getElementById('btnAddPage');
      btnBack.style.display = 'none';
      let doc = document.getElementById('document');
      let template = document.getElementById('pageTemplate');
      const mapToPreview = [0, 5, 1, 4, 2, 7, 3, 6];
      const mapRestore = [0, 2, 4, 6, 3, 1, 7, 5];
      sample();
      function addPage() {
        let cells = [...document.querySelectorAll('.cell')].map(c=>c.innerText);
        cells.push('', '', '', '');
        applyCells(cells);
      }
      function sample() {
        cells = ['', '', '', '', '', '', '', ''];
        applyCells(cells);
      }
      function preview() {
        let cells = [...document.querySelectorAll('.cell')].map(c=>c.innerText);
        cells = rearrangeForPrint(cells);
        applyCells(cells);
        btnPreview.style.display = 'none';
        btnBack.style.display = 'inline';
      }
      function restore() {
        let cells = [...document.querySelectorAll('.cell')].map(c=>c.innerText);
        cells = rearranageFromPrint(cells);
        applyCells(cells);
        btnPreview.style.display = 'inline';
        btnBack.style.display = 'none';
      }
      function rearrangeForPrint(cells) {
        const ret = [];
        for(let i=0;i<cells.length;i+=8) {
          for(let j=0;j<8;j++) {
            const newContent = (i+j) >= cells.length ? "" : cells[i+j];
            const newLoc = i + mapToPreview[j%8];
            ret[newLoc] = newContent;
          }
        }
        return ret;
      }
      function rearranageFromPrint(cells) {
        const ret = [];
        for(let i=0;i<cells.length;i+=8) {
          for(let j=0;j<8;j++) {
            const newContent = (i+j) >= cells.length ? "" : cells[i+j];
            const newLoc = i + mapRestore[j%8];
            ret[newLoc] = newContent;
          }
        }
        return ret;
      }
      function applyCells(cells) {
        doc.innerHTML = '';
        for(let i=0;i<cells.length;i+=4) {
          const p = getPage();
          p.querySelectorAll('.cell').forEach((c,j)=>{
            c.innerText = cells[i+j] || '';
          });
          doc.appendChild(p);
        }
      }
      function getPage() {
        return template.content.cloneNode(true);
      }
		</script>
	</body>
</html>

